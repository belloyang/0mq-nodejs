#ifndef MiniSEEDFileState_h__
#define MiniSEEDFileState_h__

#include "../../harvlib_defines.h"

#include <IOContext/IIOContext.h>
#include <Logger/ILogger.h>

#include <string>
#include <memory>

class MiniSEEDFileState
{
public:
  MiniSEEDFileState(const std::string& name, const uint32_t nChannels, const std::shared_ptr<ILogger>& logger);
  ~MiniSEEDFileState() = default;

  FORCE_INLINE const std::string& getName() const { return m_name; }
  FORCE_INLINE const std::shared_ptr<IIOContext>& getContext() const { return m_context; }
  FORCE_INLINE io_offset_t getRecordOffset() const { return m_recordOffset; }

  void createContext(const std::string& workingDir, const uint32_t cacheSize);

  void finishRecord(const uint32_t recordLen);
  uint8_t finishChannel();

private:
  const std::string m_name;
  uint8_t m_nChannelsToFill;
  io_offset_t m_recordOffset;
  uint32_t m_nRecords;
  std::shared_ptr<IIOContext> m_context;
  const std::shared_ptr<ILogger> m_logger;
};

#endif // MiniSEEDFileState_h__
